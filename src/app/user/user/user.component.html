<div class="col-md-6 user-container">
  <h2 class="text-center">Cliente</h2>
  <form novalidate="" class="ng-pristine ng-valid ng-touched">
    <div class="hidden">
      <input type="hidden" formcontrolname="id" placeholder="id" name="id" id="id" readonly
        class="form-control ng-untouched ng-pristine ng-valid" ng-reflect-name="id" value="1">
    </div>

    <label class="block-title">Nome: <fa-icon (click)="toggleBlock('name')" class="toggle-block"
        [icon]="blockName ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockName">
      <div class="form-group col-md-6">
        <label for="nome">Nome:</label>
        <input placeholder="{{user.nome}}" readonly name="nome" id="nome"
          class="form-control ng-pristine ng-valid ng-touched">
      </div>
      <div class="form-group col-md-6">
        <label for="cognome">Cognome/Rag.Soc.:</label>
        <input formcontrolname="cognome" placeholder="{{user.cognome}}" readonly name="cognome" id="cognome"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
    </div>

    <label class="block-title">Informazioni di residenza: <fa-icon (click)="toggleBlock('city')" class="toggle-block"
        [icon]="blockCity ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockCity">
      <div class="form-group col-md-4">
        <label for="citta">Comune</label>
        <input formcontrolname="indirizzoResidenza" placeholder="{{user.comune}}" readonly name="indirizzoResidenza"
          id="indirizzoResidenza" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-1">
        <label for="provincia">Prov.</label>
        <input formcontrolname="provincia" placeholder="{{user.provincia}}" readonly name="provincia" id="provincia"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-2">
        <label for="CAP">CAP</label>
        <input formcontrolname="CAP" placeholder="{{user.CAP}}" readonly name="CAP" id="CAP"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-4">
        <label for="indirizzoResidenza">Via:</label>
        <input formcontrolname="indirizzoResidenza" placeholder="{{user.indirizzoResidenza}}" readonly
          name="indirizzoResidenza" id="indirizzoResidenza" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-1">
        <label for="civico">Numero:</label>
        <input formcontrolname="civico" placeholder="{{user.civico}}" readonly name="civico" id="civico"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
    </div>

    <label class="block-title">Informazioni anagrafiche:<fa-icon (click)="toggleBlock('anagrafica')"
        class="toggle-block" [icon]="blockAnagrafica ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockAnagrafica">
      <div class="form-group col-md-6">
        <label for="dataNascita">Data di nascita:</label>
        <input formcontrolname="dataNascita" placeholder="{{user.dataNascita | date:'dd/MM/yyyy'}}" readonly
          name="dataNascita" id="dataNascita" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="codiceFiscale">Codice Fiscale:</label>
        <input formcontrolname="codiceFiscale" placeholder="{{user.codiceFiscale}}" readonly name="codiceFiscale"
          id="codiceFiscale" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="cartaIdentita">Carta di Identità:</label>
        <input formcontrolname="cartaIdentita" placeholder="{{user.cartaIdentita}}" readonly name="cartaIdentita"
          id="cartaIdentita" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="dataScadenzaCartaIdentita">Data Scadenza Carta Identità:</label>
        <input formcontrolname="dataScadenzaCartaIdentita"
          placeholder="{{user.dataScadenzaCartaIdentita | date:'dd/MM/yyyy'}}" readonly name="dataScadenzaCartaIdentita"
          id="dataScadenzaCartaIdentita" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="partitaIva">P.IVA:</label>
        <input formcontrolname="partitaIva" placeholder="{{user.partitaIva}}" readonly name="partitaIva" id="partitaIva"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="sdi">SDI:</label>
        <input formcontrolname="sdi" placeholder="{{user.sdi}}" readonly name="sdi" id="sdi"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-12">
        <label for="iban">IBAN:</label>
        <input formcontrolname="iban" placeholder="{{user.iban}}" readonly name="iban" id="iban"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>
    </div>

    <label class="block-title">Contatti: <fa-icon (click)="toggleBlock('contact')" class="toggle-block"
        [icon]="blockContact ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockContact">
      <div class="form-group col-md-6">
        <label for="cellulare">Cellulare:</label>
        <div class="input">
          <a href="{{'tel:' + user.cellulare}}">{{user.cellulare}}</a>
        </div>
      </div>
      <div class="form-group col-md-6">
        <label for="telCasa">Telefono 1:</label>
        <div class="input">
          <a href="{{'tel:' + user.telCasa}}">{{user.telCasa}}</a>
        </div>
      </div>
      <div class="form-group col-md-6">
        <label for="telUfficio">Telefono 2:</label>
        <div class="input">
          <a href="{{'tel:' + user.telUfficio}}">{{user.telUfficio}}</a>
        </div>
      </div>
      <div class="form-group col-md-6">
        <label for="email">Email:</label>
        <div class="input">
          <a href="{{'mailto:' + user.email}}">{{user.email}}</a>
        </div>
      </div>
      <div class="form-group col-md-6">
        <label for="secondaEmail">Email privata:</label>
        <div class="input">
          <a href="{{'mailto:' + user.secondaEmail}}">{{user.secondaEmail}}</a>
        </div>
      </div>
      <div class="form-group col-md-6">
        <label for="PEC">PEC:</label>
        <input formcontrolname="PEC" placeholder="{{user.PEC}}" readonly name="PEC" id="PEC"
          class="form-control ng-untouched ng-pristine ng-valid">
      </div>

    </div>

    <label class="block-title">Altre informazioni: <fa-icon (click)="toggleBlock('other')" class="toggle-block"
        [icon]="blockOther ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockOther">
      <div class="form-group col-md-6">
        <label for="occupazione">Occupazione:</label>
        <input formcontrolname="occupazione" placeholder="{{user.occupazione}}" readonly name="occupazione"
          id="occupazione" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="hobby">Hobby:</label>
        <textarea rows="4" formcontrolname="hobby" placeholder="{{user.hobby}}" readonly name="hobby" id="hobby"
          class="form-control ng-untouched ng-pristine ng-valid"></textarea>
      </div>
      <div class="form-group col-md-12">
        <label for="note">Collegamenti:</label>
        <textarea rows="4" formcontrolname="note" placeholder="{{user.note}}" readonly name="note" id="note"
          class="form-control ng-untouched ng-pristine ng-valid"></textarea>
      </div>
    </div>

    <label class="block-title">Gestione interna: <fa-icon (click)="toggleBlock('internal')" class="toggle-block"
        [icon]="blockInternal ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockInternal">
      <div class="form-group col-md-6">
        <label for="collaboratore">Assegnato a:</label>
        <input formcontrolname="collaboratore" placeholder="{{user.collaboratore}}" readonly name="collaboratore"
          id="collaboratore" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
      <div class="form-group col-md-6">
        <label for="tipoContatto">Tipo Contatto:</label>
        <input formcontrolname="collaboratore" placeholder="{{user.tipoContatto}}" readonly name="tipoContatto"
          id="tipoContatto" class="form-control ng-untouched ng-pristine ng-valid">
      </div>
    </div>

    <label class="block-title">Dati Aggiuntivi: <fa-icon (click)="toggleBlock('data')" class="toggle-block"
        [icon]="blockData ? faChevronDown : faChevronUp"></fa-icon></label>
    <div class="form-row" *ngIf="!blockData">
      <div class="form-group col-md-6">
        <label for="datiAggiuntivi">Dati Aggiuntivi:</label>
        <textarea rows="4" formcontrolname="datiAggiuntivi" placeholder="{{user.datiAggiuntivi}}" readonly
          name="datiAggiuntivi" id="datiAggiuntivi" class="form-control ng-untouched ng-pristine ng-valid"></textarea>
      </div>
    </div>

  </form>

  <span class="file-list">
    <span class="file-list-title" *ngIf="fileList.length">Polizze:</span>

    <table *ngIf="fileList.length" class="row-border hover table">
      <thead class="border-table">
        <tr>
          <th (click)="orderBy('numero','file')">Numero</th>
          <th (click)="orderBy('data','file')">Scadenza</th>
          <th (click)="orderBy('note','file')">Note</th>
          <th (click)="orderBy('sottotipoDoc','file')">Compagnia</th>
          <th>File</th>
          <th></th>
        </tr>
      </thead>
      <tbody class="border-table">
        <tr class="item" *ngFor="let file of fileList">
          <td (click)="showHideDoc(file,true)">{{file.numero}}</td>
          <td (click)="showHideDoc(file,true)">{{file.data | date:'dd/MM/yyyy'}}</td>
          <td (click)="showHideDoc(file,true)">{{file.note}}</td>
          <td (click)="showHideDoc(file,true)">{{file.sottotipoDoc}}</td>
          <td class="item-file" (click)="getFile(file.fileName)">{{file.fileName}}</td>
          <td class="buttons">
            <button class="btn btn-danger" (click)="deleteFile(file)">Cancella</button>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="!fileList.length" class="row-border hover table">
      Non ci sono polizze
    </div>
  </span>

  <span class="doc-list">
    <span class="doc-list-title" *ngIf="docList.length">Documenti:</span>

    <table *ngIf="docList.length" class="row-border hover table">
      <thead class="border-table">
        <tr>
          <th (click)="orderBy('tipoDoc','docs')">Tipo</th>
          <th (click)="orderBy('data','docs')">Scadenza</th>
          <th (click)="orderBy('note','docs')">Note</th>
          <th (click)="orderBy('sottotipoDoc','docs')">Compagnia</th>
          <th>File</th>
          <th></th>
        </tr>
      </thead>
      <tbody class="border-table">
        <tr class="item" *ngFor="let doc of docList">
          <td (click)="showHideDoc(doc,true)">{{doc.tipoDoc}}</td>
          <td (click)="showHideDoc(doc,true)">{{doc.data | date:'dd/MM/yyyy'}}</td>
          <td (click)="showHideDoc(doc,true)">{{doc.note}}</td>
          <td (click)="showHideDoc(doc,true)">{{doc.sottotipoDoc}}</td>
          <td class="item-file" (click)="getFile(doc.fileName)">{{doc.fileName}}</td>
          <td class="buttons">
            <button class="btn btn-danger" (click)="deleteFile(doc)">Cancella</button>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="!docList.length" class="row-border hover table">
      Non ci sono documenti
    </div>
  </span>

  <div class="choose-doc">
    Scegli tipo documento da caricare:
    <select class="custom-select small" (change)="onSelectChange(tipoDoc)" [(ngModel)]="tipoDoc">
      <option *ngFor="let doc of tipoDocs" [ngValue]="doc">{{doc}}</option>
    </select>
  </div>

  <button class="add-btn" (click)="showHideDoc()">Inserisci {{tipoDoc}}</button> <br>

  <div (click)="showHideDoc()" class="outer-elem" *ngIf="docSection"></div>
  <div class="upload-group modal-window" *ngIf="docSection">
    <span class="title-note">
      <span class="title-note">
        <b>{{tipoDoc}}</b>
        <div class="close-modal" (click)="showHideDoc()">
          <fa-icon [icon]="faWindowClose"></fa-icon>
        </div>
      </span>
    </span>
    <div class="modal-container">
      <span>
        <div class="form-group col-md-2">
          <label for="numero">Numero:</label>
          <input placeholder="numero" name="numero" [(ngModel)]="numero" id="numero"
            class="form-control ng-untouched ng-pristine ng-valid">
        </div>
      </span>
      <span>
        <div class="form-group col-md-2">
          <label for="targa">Targa:</label>
          <input placeholder="targa" name="targa" [(ngModel)]="targa" id="targa"
            class="form-control ng-untouched ng-pristine ng-valid">
        </div>
      </span>
      <span>
        <div class="form-group col-md-2">
          <label for="premioRata">Premio Rata:</label>
          <input placeholder="premioRata" name="premioRata" [(ngModel)]="premioRata" id="premioRata"
            class="form-control ng-untouched ng-pristine ng-valid">
        </div>
      </span>
      <div class="sottotipodoc-section"
        *ngIf="tipoDoc==='polizza' || tipoDoc==='preventivo' || tipoDoc==='documento' || tipoDoc==='SIC'">
        <label for="sottotipodoc">{{(tipoDoc==='polizza' || tipoDoc==='SIC') ? 'Compagnia':'Tipo'}} : </label>
        <select class="custom-select small" [(ngModel)]="sottotipoDoc">
          <option *ngFor="let sottotipo of sottotipoDocs" [ngValue]="sottotipo">{{sottotipo}}</option>
        </select>
      </div>
      <span *ngIf="tipoDoc!=='libretto di circolazione'">
        Data di scadenza:
        <div class="form-group">
          <input class="form-control w-25 small" placeholder="Scegli Data" [ngxDatePicker]="dateInstanceSingle"
            [value]="singleDate" (valueChange)="onChangeSingle($event)">
          <ngx-date-picker #dateInstanceSingle [options]="singleDatePickerOptions"></ngx-date-picker>
        </div>
      </span>
      <span>
        <div class="form-group">
          Frazionamento semestrale: <input type="checkbox" [(ngModel)]="frazionamentoSemestrale">
        </div>
      </span>
      <span>
        <div class="form-group col-md-12">
          <label for="note-doc">Note:</label>
          <textarea rows="4" placeholder="testo" name="noteDoc" id="noteDoc" [(ngModel)]="noteDoc"
            class="form-control ng-untouched ng-pristine ng-valid"></textarea>
        </div>
      </span>
      <span>
        <div class="form-group col-md-12">
          <label for="note-doc">File:</label>
          <span class="item-file" (click)="getFile(fileName)">{{fileName}}</span>
        </div>
      </span>
      <div class="btn-doc-container" *ngIf="editDoc">
        <button style="margin-top:20px" class="btn btn-warning" (click)="editDocument()" mat-raised-button
          color="primary">
          Modifica
        </button>
      </div>
      <div class="btn-doc-container" *ngIf="!docReadOnly">
        <input [formControl]="file" (change)="fileChange(index,$event)" type="file" placeholder="File">
        <button style="margin-top:20px" (click)="uploadFile()" mat-raised-button color="primary">
          Carica e Salva
        </button> (Max 50Mb)
      </div>
      <div *ngIf="uploading" class="uploading">
        Caricamento in corso...
      </div>

    </div>
  </div>
  <br>
  <span class="note-list">
    <span class="note-list-title" *ngIf="noteList.length">Note:</span>
    <table *ngIf="noteList.length" class="row-border hover note table">
      <thead>
        <tr>
          <th>Data</th>
          <th>Titolo</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr class="item" *ngFor="let note of noteList">
          <td (click)="showNote(note)">{{note.data | date:'dd/MM/yyyy'}}</td>
          <td (click)="showNote(note)">{{note.titolo }}</td>
          <td class="buttons">
            <button class="btn btn-danger" (click)="deleteNote(note)">Cancella</button>
          </td>
        </tr>
      </tbody>
    </table>
  </span>
  <br>
  <button class="add-btn" (click)="showHideNote()">Inserisci Note</button>
  <!-- modale NOTE -->
  <div (click)="showHideNote()" class="outer-elem" *ngIf="noteSection"></div>
  <div class="note-group modal-window" *ngIf="noteSection">
    <span class="title-note">
      <b>{{noteReadOnly ? 'Visualizza':'Inserisci'}} Nota</b>
      <div class="close-modal" (click)="showHideNote()">
        <fa-icon [icon]="faWindowClose"></fa-icon>
      </div>
    </span>
    <div class="form-group col-md-6">
      <label for="titolo">Titolo:</label>
      <input placeholder="titolo" [readonly]="noteReadOnly" name="titolo" [(ngModel)]="noteTitle" id="titolo"
        class="form-control ng-untouched ng-pristine ng-valid">
    </div>
    <div class="form-group col-md-12">
      <label for="testo">Testo:</label>
      <textarea [readonly]="noteReadOnly" rows="4" [(ngModel)]="noteText" placeholder="testo" name="testo" id="testo"
        class="form-control ng-untouched ng-pristine ng-valid"></textarea>
    </div>
    <button style="margin-top:20px" *ngIf="!noteReadOnly" (click)="addNote()" mat-raised-button color="primary">
      Inserisci
    </button>
  </div>

  <footer class="footer">
    <div class="edit-user-container">
      <span (click)="editUser()">Modifica Utente </span>
      <fa-icon [icon]="faEdit"></fa-icon>
    </div>
  </footer>
</div>